<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/styles.css">
    <title>P√°gina de Rifa</title>
    <style>
        /* Estilo para n√∫meros selecion√°veis */
        .numero-selecionavel {
            cursor: pointer;
        }

        .selected {
            background-color: orange !important;
        }

        /* CSS para o ret√¢ngulo de exibi√ß√£o de pre√ßo */
        .price-display {
            background-color: #f1f1f1;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            transition: height 0.3s;
            overflow: hidden;
            z-index: 9999;
        }

        /* CSS para o pre√ßo dentro do ret√¢ngulo */
        #total-price {
            font-weight: bold;
        }
    </style>
</head>
<body>
<header class="header">
    <nav class="navbar">
        <div class="logo">
            <a href="#"><img src="/images/logo.png" alt="Logo"></a>
        </div>
        <div class="menu">
            <a href="index">In√≠cio</a>
        </div>
        <div class="search">
            <input type="text" placeholder="Digite o n√∫mero do celular">
            <button class="text-xs font-medium sm:text-base flex-none border bg-white max-w-max border-Black-100 rounded-lg px-3 py-1"> üîé Buscar bilhetes </button>
        </div>
    </nav>
</header>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<br>
<div class="rifa-selection">
    <p><b>üîéSelecione uma rifa</b></p>
    <hr>
    <select id="rifasSelect">
        <option value="">Selecione uma rifa</option>
        <!-- Usando Thymeleaf para iterar sobre os c√≥digos de rifa e criar as op√ß√µes -->
        <option th:each="codigoRifa : ${codigosRifa}" th:value="${codigoRifa}" th:text="${codigoRifa}"></option>
    </select>
</div>

<br>
<br>
<br>

<div class="main-section">
    <div class="left-column">

        <p class="rifa-title">Descri√ß√£o da Rifa</p>

        <div class="prize-rectangle">
            <div class="prize-image">
                <img src="/images/premio.png" alt="Pr√™mio">
            </div>
        </div>
    </div>

    <div class="right-column">
        <!-- Tr√™s ret√¢ngulos para informa√ß√µes -->
        <div class="info-rectangle-1">
            <p>Pre√ßo da Rifa</p>
            <p th:text="${rifa.preco}" id="preco-rifa" class="preco-rifa"></p>
            <p>Total de N√∫meros</p>
            <p th:text="${rifa.quantidade_numeros_rifa}" id="quantidadeNumerosRifa"></p>
        </div>

        <div class="info-rectangle-2">
            <p>Sorteio: Loteria Federal</p>
        </div>

        <div class="info-rectangle-3">
            <p>Pr√™mio</p>
            <p th:text="${rifa.premio}"></p>
        </div>
    </div>
</div>

<br>
<br>
<br>

<div class="description-column" style="text-align: justify;">
    <p><b>üìïRegulamento / Descri√ß√£o</b></p>
    <hr>
    <p th:text="${rifa.regulamento}"></p>
</div>

<h1 class="centered-title">Escolha um n√∫mero</h1>

<table>
    <tbody id="numero-matrix">
    <!-- Os n√∫meros ser√£o preenchidos dinamicamente aqui usando JavaScript -->
    </tbody>
</table>

<script>
    // JavaScript em rifa.html
    document.addEventListener("DOMContentLoaded", function () {
        const rifaSelect = document.getElementById("rifasSelect");
        const quantidadeNumerosRifaElement = document.getElementById("quantidadeNumerosRifa");
        const quantidadeNumerosRifa = parseInt(quantidadeNumerosRifaElement.textContent);

        // Fun√ß√£o para criar e preencher a matriz de n√∫meros
        function createNumberMatrix() {
            const numeroMatrix = document.getElementById('numero-matrix');
            let numero = 1;
            const maxColunas = 15; // N√∫mero m√°ximo de colunas por linha

            for (let row = 0; row < Math.ceil(quantidadeNumerosRifa / maxColunas); row++) {
                const newRow = document.createElement('tr');

                for (let col = 0; col < maxColunas && numero <= quantidadeNumerosRifa; col++) {
                    const newCell = document.createElement('td');
                    newCell.textContent = numero;
                    newCell.classList.add("numero-selecionavel"); // Adicione a classe "numero-selecionavel" aos n√∫meros

                    // Adicione um ouvinte de evento de clique a cada c√©lula
                    newCell.addEventListener("click", function () {
                        // Toggle da classe "selected" para manter o n√∫mero laranja ap√≥s o clique
                        newCell.classList.toggle("selected");

                        // Chame a fun√ß√£o para atualizar o pre√ßo
                        updatePriceDisplay();
                    });
                    newRow.appendChild(newCell);
                    numero++;
                }

                numeroMatrix.appendChild(newRow);
            }
        }

        // Chame a fun√ß√£o para gerar a matriz de n√∫meros quando a p√°gina for carregada
        createNumberMatrix();

        // Verifique se h√° um par√¢metro 'id_rifa' na URL e defina o valor selecionado no combobox
        const urlParams = new URLSearchParams(window.location.search);
        const idRifa = urlParams.get("id_rifa");
        if (idRifa) {
            rifaSelect.value = idRifa;
        }

        // Adicione um ouvinte de evento ao combobox
        rifaSelect.addEventListener("change", function () {
            // Obt√©m o valor selecionado (o c√≥digo da rifa)
            const selectedRifa = rifaSelect.value;

            // Atualiza a URL da p√°gina com o novo valor selecionado
            const currentUrl = window.location.href;
            const newUrl = updateQueryStringParameter(currentUrl, 'id_rifa', selectedRifa);
            window.location.href = newUrl;
        });

        // Fun√ß√£o para verificar se h√° n√∫meros selecionados e mostrar/ocultar o rodap√©
        function updatePriceDisplay() {
            const selectedNumbers = document.querySelectorAll(".numero-selecionavel.selected");
            const priceDisplay = document.getElementById("price-display");
            const precoRifaElement = document.querySelector(".preco-rifa");
            const precoDisplayElement = document.getElementById("preco-rifa-dinamico");
            let contador = selectedNumbers.length; // Atualize o contador com a quantidade de n√∫meros selecionados

            if (contador > 0) {
                priceDisplay.style.height = "50px"; // Defina a altura desejada do rodap√©
                // Obtenha o pre√ßo da rifa do elemento atual
                const precoRifa = parseFloat(precoRifaElement.textContent);

                // Multiplique o pre√ßo da rifa pelo valor do contador
                const precoMultiplicado = precoRifa * contador;

                // Exiba o pre√ßo multiplicado no novo local
                precoDisplayElement.textContent = precoMultiplicado.toFixed(2);
            } else {
                priceDisplay.style.height = "0"; // Oculte o rodap√© se nenhum n√∫mero estiver selecionado
                precoDisplayElement.textContent = "0.00"; // Defina o pre√ßo como 0 quando nenhum n√∫mero estiver selecionado
            }
        }
    });

    // Fun√ß√£o auxiliar para atualizar par√¢metros de consulta na URL
    function updateQueryStringParameter(uri, key, value) {
        const re = new RegExp("([?&])" + key + "=.*?(&|$)", "i");
        const separator = uri.indexOf('?') !== -1 ? "&" : "?";
        if (uri.match(re)) {
            return uri.replace(re, '$1' + key + "=" + value + '$2');
        }
        else {
            return uri + separator + key + "=" + value;
        }
    }
</script>





<div class="price-display" id="price-display">
    <p>Pre√ßo da Rifa: <span id="preco-rifa-dinamico"></span></p>
</div>

<h1 class="centered-title">üí≥üí∞ Formas de pagamentos</h1>
<div class="pix-rectangle">
    <div class="pix-image">
        <img src="/images/pix.png" alt="Pix">
    </div>
</div>

<br>
<br>
<br>

<div class="footer">
    <p>&copy; 2023 - Sistema de Financiamento Coletivo - Todos os direitos reservados</p>
</div>
</body>
</html>
